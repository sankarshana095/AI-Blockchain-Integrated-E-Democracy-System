{% extends "base.html" %}
{% set title = "Policy Feed" %}

{% block content %}
<div class="policy-feed">

    <h2>üèõÔ∏è Policy Discussions</h2>

    {% if posts %}
        {% for post in posts %}
        <div class="policy-card">

            <!-- TITLE -->
            <h3 class="policy-title">
                <a href="{{ url_for('rep_policy.view_policy', post_id=post.id) }}">
                    {{ post.title or "Public Forum Discussion" }}
                </a>
            </h3>

            <!-- META -->
            <div class="policy-meta">
                <span><strong>{{ post.author_name }}</strong></span>

                {% if post.party_name %}
                    <span class="party-badge">‚Ä¢ {{ post.party_name }}</span>
                {% endif %}

                <span class="post-time">‚Ä¢ {{ post.time_ago }}</span>
            </div>

            <!-- IMAGE PREVIEW -->
            {% if post.image_urls %}
            <div class="policy-preview-images">
                <img src="{{ post.image_urls[0] }}" class="preview-image">
            </div>
            {% endif %}

            <!-- FOOTER -->
            <div class="policy-footer">

                <!-- VOTES -->
<div class="vote-panel">

    <!-- UPVOTE -->
    <form method="POST" action="{{ url_for('rep_policy.vote', post_id=post.id) }}">
        <input type="hidden" name="vote" value="1">
        <button type="submit" class="vote-btn upvote" aria-label="Upvote">
            ‚ñ≤
        </button>
    </form>

    <!-- SCORE -->
    <div class="score">{{ post.score }}</div>

    <!-- DOWNVOTE -->
    <form method="POST" action="{{ url_for('rep_policy.vote', post_id=post.id) }}">
        <input type="hidden" name="vote" value="-1">
        <button type="submit" class="vote-btn downvote" aria-label="Downvote">
            ‚ñº
        </button>
    </form>

</div>


                <!-- COMMENTS -->
                <div class="comment-count">
                    üí¨ {{ post.comment_count }}
                </div>

            </div>

        </div>
        {% endfor %}
    {% else %}
        <p>No policy posts yet.</p>
    {% endif %}

    {% if session.role in ["ELECTED_REP", "OPPOSITION_REP"] %}
        <a href="{{ url_for('rep_policy.create_policy') }}" class="btn-primary">
            ‚ûï Create Policy Post
        </a>
    {% endif %}

</div>
{% endblock %}
