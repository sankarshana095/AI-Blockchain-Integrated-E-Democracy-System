{% extends "base.html" %}
{% set title = "My Issues" %}

{% block content %}
<div class="my-issues-page">

    <div class="page-header">
        <h2>ğŸ§‘â€âš–ï¸ My Raised Issues</h2>
        <a href="{{ url_for('citizen.new_issue') }}" class="btn-primary">
            Raise New Issue
        </a>
    </div>

    {% if issues %}
        {% for issue in issues %}
            <div class="issue-card">

    <!-- Voting Column -->
    <div class="vote-column">
        <button
            class="vote-btn up {% if issue.user_vote == 'up' %}active{% endif %}"
            onclick="voteIssue('{{ issue.id }}', 'up')"
        >
            â–²
        </button>

        <div class="vote-score">
            {{ issue.score }}
        </div>

        <button
            class="vote-btn down {% if issue.user_vote == 'down' %}active{% endif %}"
            onclick="voteIssue('{{ issue.id }}', 'down')"
        >
            â–¼
        </button>
    </div>

    <div class="issue-content">

        <!-- Top Meta -->
        <div class="issue-meta-top">
            <span class="username">
                u/{{ issue.username }}
            </span>

            â€¢

            <span class="status status-{{ issue.status|lower }}">
                {{ issue.status }}
            </span>

            â€¢

            <span class="time">
                {{ issue.time_ago }}
            </span>
        </div>

        <!-- Title -->
        <a
            href="{{ url_for('citizen.issue_detail', issue_id=issue.id) }}"
            class="issue-title"
        >
            {{ issue.title }}
        </a>

        <!-- Image -->
        {% if issue.first_image %}
            <div class="issue-image-preview">
                <img src="{{ issue.first_image }}">
            </div>
        {% endif %}

        <!-- Description -->
        <p class="issue-preview">
            {{ issue.description[:180] }}
            {% if issue.description|length > 180 %}...{% endif %}
        </p>

        <!-- Footer -->
        <div class="issue-footer">
            ğŸ’¬ {{ issue.comment_count }} comments

            {% if issue.status == "Resolved" %}
                <span class="resolved-indicator">
                    â€¢ Awaiting your confirmation
                </span>
            {% endif %}
        </div>

    </div>
</div>

        {% endfor %}
    {% else %}
        <div class="empty-state">
            <p>You havenâ€™t raised any issues yet.</p>
            <a href="{{ url_for('citizen.new_issue') }}" class="btn-secondary">
                Raise Your First Issue
            </a>
        </div>
    {% endif %}

</div>
<script src="{{ url_for('static', filename='js/issue.js') }}"></script>

{% endblock %}
