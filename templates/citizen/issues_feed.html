{% extends "base.html" %}
{% set title = "Issues Feed" %}

{% block content %}
<div class="issues-feed">

    <div class="feed-header">
        <h2>ğŸ›ï¸ Constituency Issues</h2>
        <a href="{{ url_for('citizen.new_issue') }}" class="btn-primary">
            Raise Issue
        </a>
    </div>

    {% if issues %}
        {% for issue in issues %}
            <div class="issue-card">

                <!-- Voting -->
                <div class="vote-column">
                    <button
                        class="vote-btn up {% if issue.user_vote == 'up' %}active{% endif %}"
                        onclick="voteIssue('{{ issue.id }}', 'up')"
                    >
                        â–²
                    </button>

                    <div class="vote-score">
                        {{ issue.score }}
                    </div>

                    <button
                        class="vote-btn down {% if issue.user_vote == 'down' %}active{% endif %}"
                        onclick="voteIssue('{{ issue.id }}', 'down')"
                    >
                        â–¼
                    </button>
                </div>

                <!-- Content -->
                <div class="issue-content">

                    <!-- Top Meta -->
                    <div class="issue-meta-top">
                        <span class="username">
                            u/{{ issue.username }}
                        </span>

                        â€¢

                        <span class="status status-{{ issue.status|lower }}">
                            {{ issue.status }}
                        </span>

                        â€¢

                        <span class="time">
                            {{ issue.time_ago }}
                        </span>
                    </div>

                    <!-- Title -->
                    <a
                        href="{{ url_for('citizen.issue_detail', issue_id=issue.id) }}"
                        class="issue-title"
                    >
                        {{ issue.title }}
                    </a>

                    <!-- Image Preview -->
                    {% if issue.first_image %}
                        <div class="issue-image-preview">
                            <img src="{{ issue.first_image }}">
                        </div>
                    {% endif %}

                    <!-- Description -->
                    <p class="issue-preview">
                        {{ issue.description[:200] }}
                        {% if issue.description|length > 200 %}...{% endif %}
                    </p>

                    <!-- Footer -->
                    <div class="issue-footer">
                        ğŸ’¬ {{ issue.comment_count }} comments
                    </div>

                </div>
            </div>
        {% endfor %}
    {% else %}
        <p>No issues raised in your constituency yet.</p>
    {% endif %}

</div>

<script src="{{ url_for('static', filename='js/issue.js') }}"></script>
{% endblock %}
