{% extends "base.html" %}
{% set title = "Issues Feed" %}

{% block content %}
<div class="issues-feed">

    <div class="feed-header">
        <h2>ğŸ›ï¸ Constituency Issues</h2>
        <a href="{{ url_for('citizen.new_issue') }}" class="btn-primary">
            Raise Issue
        </a>
    </div>

    {% if issues %}
        {% for issue in issues %}
            <div class="issue-card">

                <!-- =========================
                     Voting Column
                ========================== -->
                <div class="vote-column">
                    <button
                        class="vote-btn"
                        onclick="voteIssue('{{ issue.id }}', 'up')"
                    >
                        â–²
                    </button>

                    <div class="vote-score">
                        {{ issue.score or 0 }}
                    </div>

                    <button
                        class="vote-btn"
                        onclick="voteIssue('{{ issue.id }}', 'down')"
                    >
                        â–¼
                    </button>
                </div>

                <!-- =========================
                     Issue Content
                ========================== -->
                <div class="issue-content">

                    <a
                        href="{{ url_for('citizen.issue_detail', issue_id=issue.id) }}"
                        class="issue-title"
                    >
                        {{ issue.title }}
                    </a>

                    <div class="issue-meta">
                        <span class="category">
                            {{ issue.category }}
                        </span>

                        <span class="status status-{{ issue.status|lower }}">
                            {{ issue.status }}
                        </span>

                        <span class="date">
                            {{ issue.created_at }}
                        </span>
                    </div>

                    <p class="issue-preview">
                        {{ issue.description[:140] }}{% if issue.description|length > 140 %}...{% endif %}
                    </p>

                    <div class="issue-actions">
                        <a href="{{ url_for('citizen.issue_detail', issue_id=issue.id) }}">
                            ğŸ’¬ View Discussion
                        </a>
                    </div>

                </div>
            </div>
        {% endfor %}
    {% else %}
        <p>No issues raised in your constituency yet.</p>
    {% endif %}

</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/issue.js') }}"></script>
{% endblock %}
