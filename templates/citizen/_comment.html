<div class="comment-card" style="margin-left: {{ level * 20 }}px;">

    <!-- Comment Header -->
    <div class="comment-header">
        <a href="#"
           class="toggle-thread"
           onclick="toggleThread('{{ comment.id }}'); return false;">
            <span id="toggle-icon-{{ comment.id }}">[â€“]</span>
        </a>
            <span class="comment-username">
        {% if comment.role == "CITIZEN" %}
    u/{{ comment.display_name }}
{% else %}
    {{ comment.display_name }}
{% endif %}

    </span>
         {% if comment.is_op %}
        <span class="op-badge">OP</span>
    {% endif %}
    {% if comment.is_official %}
          {% if comment.role == "ELECTED_REP" %}
    <span class="official-badge">Official Response</span>
{% else %}
    <span class="opposition-badge">Opposition Response</span>
{% endif %}    
    {% endif %}
    <span class="comment-time">
        {{ comment.created_at }}
    </span>
    </div>

    <!-- Comment Body -->
    <p class="comment-text">
        {{ comment.comment }}
    </p>

    <!-- Actions -->
    <div class="comment-actions">
        <a href="#" onclick="toggleReply('{{ comment.id }}'); return false;">
            Reply
        </a>
    </div>

    <!-- Reply Form -->
    <form
        id="reply-form-{{ comment.id }}"
        method="POST"
        action="{{ url_for('citizen.add_issue_comment', issue_id=issue_id) }}"
        style="display:none;"
    >
        <input type="hidden" name="parent_comment_id" value="{{ comment.id }}">
        <textarea name="comment" rows="2" required></textarea>
        <button class="btn-secondary">Reply</button>
    </form>

    <!-- Replies Container -->
    <div
        id="replies-{{ comment.id }}"
        class="comment-replies"
    >
        {% for reply in comment.replies %}
{% set level = level + 1 %}
{% set comment = reply %}
{% include "citizen/_comment.html" %}

        {% endfor %}
    </div>
</div>