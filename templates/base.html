<!DOCTYPE html>
<html lang="en" data-theme="system">
<head>
    <meta charset="UTF-8">
    <title>{{ title if title else "E-Democracy System" }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Hint to browser: honour dark/light at the OS level for native UI (scrollbars, inputs) -->
    <meta name="color-scheme" content="light dark">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,700;1,9..40,300&family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Apply theme BEFORE paint to avoid flash -->
    <script>
        (function(){
            var saved = localStorage.getItem('theme') || 'system';
            document.documentElement.setAttribute('data-theme', saved);
        })();
    </script>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">

    <style>
    /* ═══ CSS VARIABLES — LIGHT (default) ═══ */
    :root {
        --ink:          #ffffff;
        --ink-2:        #f5f5fb;
        --ink-3:        #ebebf7;
        --border:       rgba(79,70,229,0.14);
        --indigo:       #4f46e5;
        --indigo-dark:  #3730a3;
        --indigo-light: #818cf8;
        --indigo-dim:   rgba(79,70,229,0.08);
        --indigo-mid:   rgba(79,70,229,0.18);
        --warm:         #f59e0b;
        --warm-light:   #fcd34d;
        --warm-dim:     rgba(245,158,11,0.12);
        --teal:         #0d9488;
        --teal-dim:     rgba(13,148,136,0.12);
        --text:         #0f0f14;
        --text-2:       #2d2d3a;
        --muted:        #6b7280;
        --font-disp:    'Bebas Neue', sans-serif;
        --font-body:    'DM Sans', sans-serif;
        --font-mono:    'JetBrains Mono', monospace;
        --nav-h:        56px;
        --sidebar-w:    320px;

        --sidebar-bg:       #ffffff;
        --card-bg:          #ffffff;
        --card-hover-bg:    #fafafe;
        --input-focus-bg:   #ffffff;
        --nav-scrolled-bg:  rgba(255,255,255,0.55);

        /* Native UI elements follow theme */
        color-scheme: light;
    }

    /* ═══ DARK MODE ═══ */
    [data-theme="dark"] {
        --ink:          #0d0d12;
        --ink-2:        #13131c;
        --ink-3:        #1a1a27;
        --border:       rgba(129,140,248,0.15);
        --indigo:       #818cf8;
        --indigo-dark:  #6366f1;
        --indigo-light: #a5b4fc;
        --indigo-dim:   rgba(129,140,248,0.1);
        --indigo-mid:   rgba(129,140,248,0.2);
        --warm:         #fbbf24;
        --warm-light:   #fde68a;
        --warm-dim:     rgba(251,191,36,0.12);
        --teal:         #2dd4bf;
        --teal-dim:     rgba(45,212,191,0.12);
        --text:         #f0f0fa;
        --text-2:       #c4c4d4;
        --muted:        #9ca3b0;
        --sidebar-bg:       #111118;
        --card-bg:          #17171f;
        --card-hover-bg:    #1e1e2a;
        --input-focus-bg:   #1a1a27;
        --nav-scrolled-bg:  rgba(13,13,18,0.75);
        color-scheme: dark;
    }

    /* ═══ SYSTEM PREFERENCE ═══ */
    @media (prefers-color-scheme: dark) {
        [data-theme="system"] {
            --ink:          #0d0d12;
            --ink-2:        #13131c;
            --ink-3:        #1a1a27;
            --border:       rgba(129,140,248,0.15);
            --indigo:       #818cf8;
            --indigo-dark:  #6366f1;
            --indigo-light: #a5b4fc;
            --indigo-dim:   rgba(129,140,248,0.1);
            --indigo-mid:   rgba(129,140,248,0.2);
            --warm:         #fbbf24;
            --warm-light:   #fde68a;
            --warm-dim:     rgba(251,191,36,0.12);
            --teal:         #2dd4bf;
            --teal-dim:     rgba(45,212,191,0.12);
            --text:         #f0f0fa;
            --text-2:       #c4c4d4;
            --muted:        #9ca3b0;
            --sidebar-bg:       #111118;
            --card-bg:          #17171f;
            --card-hover-bg:    #1e1e2a;
            --input-focus-bg:   #1a1a27;
            --nav-scrolled-bg:  rgba(13,13,18,0.75);
            color-scheme: dark;
        }
    }

    /* ═══ SMOOTH THEME TRANSITIONS ═══
       Apply only to layout/text elements, NOT to SVG, canvas,
       animation containers, or cursor elements.
    ══════════════════════════════════ */
    *,
    *::before,
    *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    /* Transition only on non-graphical elements */
    :not(svg):not(canvas):not(img):not(.cursor-dot):not(.cursor-ring):not(.logo-mark *),
    :not(svg):not(canvas):not(img):not(.cursor-dot):not(.cursor-ring):not(.logo-mark *)::before,
    :not(svg):not(canvas):not(img):not(.cursor-dot):not(.cursor-ring):not(.logo-mark *)::after {
        transition:
            background-color .25s ease,
            border-color     .25s ease,
            color            .25s ease,
            box-shadow       .25s ease,
            outline-color    .25s ease;
    }

    /* Noise overlay — never transition (it's a fixed texture) */
    body::before { transition: none !important; }

    /* ═══ GLOBAL DARK SURFACE OVERRIDES ═══
       Covers all hardcoded #fff / #f8f8fd backgrounds across every template.
       Grouped by template for clarity.
    ══════════════════════════════════════ */

    /* ── base.html existing overrides ── */
    [data-theme="dark"] *[style*="background:#fff"],
    [data-theme="dark"] *[style*="background: #fff"] {
        background: var(--card-bg) !important;
    }

    [data-theme="dark"] .desc-card,
    [data-theme="dark"] .section-card,
    [data-theme="dark"] .sidebar-card,
    [data-theme="dark"] .issue-vote-bar,
    [data-theme="dark"] .vote-panel,
    [data-theme="dark"] .statement-card,
    [data-theme="dark"] .ai-card,
    [data-theme="dark"] .comments-section,
    [data-theme="dark"] .policy-card,
    [data-theme="dark"] .feed-empty,
    [data-theme="dark"] .timeline-dot,
    [data-theme="dark"] .comment-card { background: var(--card-bg); }

    [data-theme="dark"] .issue-card:hover,
    [data-theme="dark"] .policy-card:hover { background: var(--card-hover-bg); }

    [data-theme="dark"] textarea:focus,
    [data-theme="dark"] input:focus { background: var(--input-focus-bg) !important; }

    [data-theme="dark"] .timeline-dot:not(.active):not(.resolved) {
        background: var(--card-bg);
        border-color: var(--border);
    }

    [data-theme="dark"] .ai-summary-text { background: var(--indigo-dim); }
    [data-theme="dark"] .comment-body.ai-body { background: var(--indigo-dim); }
    [data-theme="dark"] .comment-official .comment-text { background: var(--indigo-dim); }
    [data-theme="dark"] .comment-ai .comment-text { background: var(--warm-dim); }
    [data-theme="dark"] .claim-item { background: var(--ink-2); }
    [data-theme="dark"] .pc-vote-col { background: var(--ink-3); }
    [data-theme="dark"] .vote-bar-btn { background: transparent; }
    [data-theme="dark"] .vote-bar-btn:hover { background: var(--indigo-dim); }

    /* ── deo_dashboard.html ── */
    [data-theme="dark"] .action-card { background: var(--card-bg); }
    [data-theme="dark"] .action-card:hover { background: var(--card-hover-bg) !important; }
    [data-theme="dark"] .responsibilities-card { background: var(--card-bg); }

    /* ── voter_mgmt.html ── */
    [data-theme="dark"] .voter-table tbody tr:not(.edit-row):hover { background: var(--indigo-dim) !important; }

    /* ── po_dashboard.html ── */
    [data-theme="dark"] .panel { background: var(--card-bg); }
    [data-theme="dark"] .field input[type="text"]:focus,
    [data-theme="dark"] .field input[type="number"]:focus,
    [data-theme="dark"] .field select:focus { background: var(--input-focus-bg) !important; }
    [data-theme="dark"] .otp-input:focus { background: var(--input-focus-bg) !important; }
    [data-theme="dark"] .otp-input:not(:placeholder-shown) { background: var(--indigo-dim); }

    /* ── nomination.html ── */
    [data-theme="dark"] .form-panel { background: var(--card-bg); }
    [data-theme="dark"] .form-group input:focus,
    [data-theme="dark"] .form-group select:focus { background: var(--input-focus-bg) !important; }
    [data-theme="dark"] .select-dropdown { background: var(--card-bg); }
    [data-theme="dark"] .select-option:hover,
    [data-theme="dark"] .select-option.focused { background: var(--indigo-dim); color: var(--indigo); }

    /* ── evote_waiting.html ── */
    [data-theme="dark"] .evote-card { background: var(--card-bg); }

    /* ── verify_vote.html ── */
    [data-theme="dark"] .select-search-box:focus,
    [data-theme="dark"] .custom-select-wrap.open .select-search-box { background: var(--input-focus-bg) !important; }
    [data-theme="dark"] .select-search-box { background: var(--ink-2); }
    [data-theme="dark"] .hash-input:focus { background: var(--input-focus-bg) !important; }
    [data-theme="dark"] .result-body { background: var(--card-bg); }
    [data-theme="dark"] .custom-select-wrap .select-dropdown { background: var(--card-bg); }

    /* ── vote.html (cast vote) ── */
    [data-theme="dark"] .vote-card { background: var(--card-bg); }
    [data-theme="dark"] .candidate-option input[type="radio"] {
        background: var(--ink-3);
        border-color: var(--border);
    }
    [data-theme="dark"] .candidate-option input[type="radio"]:checked {
        background: var(--indigo);
        border-color: var(--indigo);
    }
    [data-theme="dark"] .candidate-option:has(input:checked) {
        background: var(--indigo-dim);
    }
    [data-theme="dark"] .candidate-option:hover { background: var(--ink-2); }

    /* ── manage_ro.html ── */
    [data-theme="dark"] .table-search { background: var(--ink-2) !important; border-color: var(--border); }

    /* ── Shared: catch-all ── */
    [data-theme="dark"] .table-card,
    [data-theme="dark"] .result-panel .result-body,
    [data-theme="dark"] .evote-card-head,
    [data-theme="dark"] .vote-card-head { background: var(--ink-2); }

    /* ── index.html ── */
    /* .chain-block, .feature-item:hover, .role-card:hover, .step-num use #fff */
    [data-theme="dark"] .chain-block {
        background: var(--card-bg);
        border-color: var(--border);
        box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    }
    [data-theme="dark"] .feature-item { background: var(--card-bg); }
    [data-theme="dark"] .feature-item:hover { background: var(--card-hover-bg); }
    [data-theme="dark"] .role-card { background: var(--card-bg); }
    [data-theme="dark"] .role-card:hover { background: var(--card-hover-bg); }
    [data-theme="dark"] .step-num {
        background: var(--card-bg);
        border-color: var(--border);
        box-shadow: 0 2px 12px rgba(0,0,0,0.3);
    }
    [data-theme="dark"] .process-step:hover .step-num {
        background: var(--indigo);
        border-color: var(--indigo);
    }

    /* ── about.html ── */
    /* .tech-card, .timeline-item, .team-card hover use #fff */
    [data-theme="dark"] .tech-card { background: var(--card-bg); }
    [data-theme="dark"] .tech-card:hover { background: var(--card-hover-bg); }
    [data-theme="dark"] .timeline-item { background: var(--card-bg); }
    [data-theme="dark"] .timeline-item:hover { background: var(--card-hover-bg); }
    [data-theme="dark"] .team-card { background: var(--card-bg); }
    [data-theme="dark"] .team-card:hover { background: var(--card-hover-bg); }

    /* ── election_schedule.html ── */
    /* .election-card base and hover use --ink and #fafafe */
    [data-theme="dark"] .election-card { background: var(--card-bg); }
    [data-theme="dark"] .election-card:hover {
        background: var(--card-hover-bg);
        box-shadow: 0 4px 24px rgba(0,0,0,0.3);
    }

    /* ── election_insights.html ── */
    /* .stat-card:hover uses #fafafe; data-table tbody tr:hover uses #f8f8fd */
    [data-theme="dark"] .stat-card { background: var(--card-bg); }
    [data-theme="dark"] .stat-card:hover { background: var(--card-hover-bg) !important; }
     [data-theme="dark"] .stat-card:hover            { background: var(--card-hover-bg) !important; }
    [data-theme="dark"] .data-table tbody tr:hover  { background: var(--indigo-dim) !important; }

    /* representatives.html — rep card hover */
    [data-theme="dark"] .rep-card:hover             { background: var(--card-hover-bg) !important; box-shadow: 0 8px 40px rgba(0,0,0,0.3); }
    [data-theme="dark"] .stat-card:hover            { background: var(--card-hover-bg) !important; }
    [data-theme="dark"] .data-table tbody tr:hover  { background: var(--indigo-dim) !important; }

    /* representatives.html — rep card hover */
    [data-theme="dark"] .rep-card:hover             { background: var(--card-hover-bg) !important; box-shadow: 0 8px 40px rgba(0,0,0,0.3); }



    [data-theme="dark"] .stat-cell { background: var(--card-bg); }
    [data-theme="dark"] .stat-cell:hover { background: var(--card-hover-bg) !important; }
    [data-theme="dark"] .data-table tbody tr:hover { background: var(--indigo-dim) !important; }
    [data-theme="dark"] .bento-cell { background: var(--card-bg); }
    [data-theme="dark"] .grid-cell { background: var(--card-bg); }
    [data-theme="dark"] .full-card { background: var(--card-bg); }

    /* ── rep_dashboard.html ── */
    /* .issue-table tbody tr:hover uses #f8f8fd; .stat-cell uses var(--ink) */
    [data-theme="dark"] .issue-table tbody tr:hover { background: var(--indigo-dim) !important; }

    /* ── public_roll.html ── */
    [data-theme="dark"] .roll-table tbody tr:hover { background: var(--indigo-dim) !important; }
    [data-theme="dark"] .selection-card { background: var(--card-bg); }

    /* ── policy_feed.html + policy_detail.html ── */
    /* .list-item:hover in about.html uses #fff for problem/solution panels */
    [data-theme="dark"] .list-item:hover { background: var(--indigo-dim) !important; }

    /* ── rep_dashboard sidebar perf card ── */
    [data-theme="dark"] .perf-card { background: var(--indigo-dark); }

    /* ── rep_accountability.html ── */
    [data-theme="dark"] .acc-score-strip           { background: var(--card-bg); }
    [data-theme="dark"] .acc-strip-item            { background: var(--card-bg); border-color: var(--border); }
    [data-theme="dark"] .dim-card                  { background: var(--card-bg); }
    [data-theme="dark"] .dim-card-head             { background: var(--ink-2); }
    [data-theme="dark"] .dim-icon                  { background: var(--ink-3); border-color: var(--border); }
    [data-theme="dark"] .dim-weight                { background: var(--ink-3); }
    [data-theme="dark"] .avg-card                  { background: var(--card-bg); }
    [data-theme="dark"] .avg-card-head             { background: var(--ink-2); }
    [data-theme="dark"] .avg-score-big             { background: var(--ink-2); border-color: var(--border); }
    [data-theme="dark"] .formula-card              { background: var(--ink-2); }
    [data-theme="dark"] .acc-alert.warn            { background: var(--warm-dim); }
    [data-theme="dark"] .acc-alert.pre-danger      { background: rgba(234,88,12,0.12); }
    [data-theme="dark"] .acc-alert.danger          { background: rgba(220,38,38,0.12); }
    [data-theme="dark"] .acc-body                  { background: var(--ink-2); }
    [data-theme="dark"] .flow-num                  { background: var(--ink-2); border-color: var(--border); }
    [data-theme="dark"] .flow-num.active           { background: var(--indigo); border-color: var(--indigo); }

    /* ── my_issues.html ── */
    [data-theme="dark"] .my-stat                   { background: var(--card-bg); }
    [data-theme="dark"] .my-stat:hover             { background: var(--card-hover-bg) !important; }
    [data-theme="dark"] .issue-card                { background: var(--card-bg); }
    [data-theme="dark"] .issue-card:hover          { background: var(--card-hover-bg) !important; }
    [data-theme="dark"] .vote-column               { background: var(--ink-2); border-color: var(--border); }

    /* ── audit_logs.html ── */
    [data-theme="dark"] .audit-stat                { background: var(--card-bg); }
    [data-theme="dark"] .audit-stat:hover          { background: var(--card-hover-bg) !important; }
    [data-theme="dark"] .audit-table tbody tr:hover { background: var(--indigo-dim) !important; }

    /* ── manage_ceo.html ── */
    [data-theme="dark"] .ceo-stat                  { background: var(--card-bg); }
    [data-theme="dark"] .ceo-stat:hover            { background: var(--card-hover-bg) !important; }
    [data-theme="dark"] .data-table tbody tr:hover { background: var(--indigo-dim) !important; }
    [data-theme="dark"] .state-tag                 { background: var(--ink-2); border-color: var(--border); color: var(--text); }
    [data-theme="dark"] .filter-tabs               { border-color: var(--border); }
    [data-theme="dark"] .filter-tab                { background: var(--ink-2); color: var(--muted); border-color: var(--border); }
    [data-theme="dark"] .filter-tab:hover          { background: var(--indigo-dim); color: var(--indigo); }
    [data-theme="dark"] .filter-tab.active         { background: var(--indigo); color: #fff; }

    /* ── notifications.html ── */
    [data-theme="dark"] .notif-item                { background: var(--card-bg); }
    [data-theme="dark"] .notif-item:hover          { background: var(--card-hover-bg); }
    [data-theme="dark"] .notif-icon-col            { background: var(--ink-2); border-color: var(--border); }
    [data-theme="dark"] .notif-icon                { background: var(--ink-3); border-color: var(--border); }
    [data-theme="dark"] .notif-empty               { background: var(--card-bg); }
    [data-theme="dark"] .notif-empty-title         { color: var(--text); }

    /* ── create_election.html ── */
    [data-theme="dark"] .form-main                 { background: var(--card-bg); }
    [data-theme="dark"] .form-section              { background: var(--card-bg); }
    [data-theme="dark"] .form-actions-bar          { background: var(--ink-2); }
    /* .sidebar-card already covered above; just add the head */
    [data-theme="dark"] .sidebar-card-head         { background: var(--ink-2); }
    [data-theme="dark"] .checkbox-item             { background: var(--card-bg); color: var(--text); }
    [data-theme="dark"] .checkbox-item:hover       { background: var(--indigo-dim); color: var(--indigo); }
    [data-theme="dark"] .checkbox-item input[type="checkbox"] {
        background: var(--ink-3);
        border-color: var(--border);
    }
    [data-theme="dark"] .checkbox-item input[type="checkbox"]:checked {
        background: var(--indigo);
        border-color: var(--indigo);
    }
    [data-theme="dark"] .constituency-grid         { background: var(--border); border-color: var(--border); }
    [data-theme="dark"] .constituency-search       { background: var(--ink-2); color: var(--text); border-color: var(--border); }
    [data-theme="dark"] .constituency-search:focus { border-color: var(--indigo); }
    [data-theme="dark"] .status-pill.amber-pill,
    [data-theme="dark"] .page-title-sub            { color: var(--muted); }

    /* ── blo_voter_verification.html ── */
    [data-theme="dark"] .voter-table               { background: var(--card-bg); }
    [data-theme="dark"] .voter-table thead         { background: var(--ink-2); }
    [data-theme="dark"] .voter-table-wrap          { border-color: var(--border); }
    [data-theme="dark"] .voter-table tbody tr:hover { background: var(--indigo-dim) !important; }
    [data-theme="dark"] .blo-stat                  { background: var(--card-bg); border-color: var(--border); }
    [data-theme="dark"] .voter-avatar-placeholder  { background: var(--indigo-dim); }
    [data-theme="dark"] .search-input              { background: var(--ink-2); border-color: var(--border); color: var(--text); }
    [data-theme="dark"] .search-input:focus        { background: var(--input-focus-bg) !important; }
    [data-theme="dark"] .sort-btn                  { background: var(--ink-2); border-color: var(--border); color: var(--muted); }
    [data-theme="dark"] .sort-btn:hover            { background: var(--indigo-dim); border-color: var(--indigo); color: var(--indigo); }
    [data-theme="dark"] .sort-btn.active           { background: var(--indigo); border-color: var(--indigo); color: #fff; }
    [data-theme="dark"] .file-input-label          { border-color: var(--border); color: var(--muted); }
    [data-theme="dark"] .file-input-label:hover    { background: var(--indigo-dim); border-color: var(--indigo); color: var(--indigo); }
    [data-theme="dark"] .blo-info-banner           { background: var(--indigo-dim); border-color: rgba(129,140,248,0.25); }

    /* ── election_insights.html ── */
    [data-theme="dark"] .hero-selector             { background: var(--ink-2); border-color: var(--border); }
    [data-theme="dark"] .hero-selector-label       { background: var(--ink-3); color: var(--muted); border-color: var(--border); }
    [data-theme="dark"] .hero-selector-wrap select {
    background: var(--ink-2) !important;
    color: var(--text);
}
[data-theme="dark"] .hero-selector-wrap { color-scheme: dark; }
    /* .stat-card is a new class name in insights — different from rep_dashboard .stat-cell */
    [data-theme="dark"] .stat-card                 { background: var(--card-bg); }
    [data-theme="dark"] .stat-card:hover           { background: var(--card-hover-bg) !important; }


    /* ── Selects and native inputs across all pages ── */
    /* ── policy_detail.html — textarea focus overrides ── */
    [data-theme="dark"] .counter-form-wrap textarea:focus { background: var(--input-focus-bg) !important; }
    [data-theme="dark"] .new-comment-form textarea:focus  { background: var(--input-focus-bg) !important; }
    [data-theme="dark"] .reply-input-wrap textarea:focus  { background: var(--input-focus-bg) !important; }
    [data-theme="dark"] .reply-input-row textarea:focus   { background: var(--input-focus-bg) !important; }

    [data-theme="dark"] select {
        background: var(--ink-2);
        color: var(--text);
        border-color: var(--border);
    }
    [data-theme="dark"] select:focus { background: var(--input-focus-bg); }

    /* ── live_results.html ── */
    /* .results-selector-strip, .selector-wrap select, .results-prompt,
       .results-summary, .results-chart all use hardcoded #fff */
    [data-theme="dark"] .results-selector-strip { background: var(--card-bg); }
    [data-theme="dark"] .selector-wrap select {
        background: var(--ink-2);
        color: var(--text);
        border-color: var(--border);
    }
    [data-theme="dark"] .selector-wrap select:focus { background: var(--input-focus-bg); }
    [data-theme="dark"] .results-prompt { background: var(--card-bg); }
    [data-theme="dark"] .results-summary { background: var(--card-bg); }
    [data-theme="dark"] .results-chart { background: var(--card-bg); }

    /* ── no_election.html ── */
    /* .no-election-card uses #fff; .back-btn:hover uses #fff */
    [data-theme="dark"] .no-election-card { background: var(--card-bg); }
    [data-theme="dark"] .back-btn { background: var(--ink-2); color: var(--text); }
    [data-theme="dark"] .back-btn:hover { background: var(--card-hover-bg); }

    /* ── results_dashboard.html (final results) ── */
    /* .select-search-box, .select-dropdown, .podium-card use #fff */
    /* .runner-badge uses #f3f4f6; notice text uses hardcoded amber values */
    [data-theme="dark"] .select-search-box { background: var(--ink-2); }
    [data-theme="dark"] .select-search-box.open,
    [data-theme="dark"] .select-search-box:focus { background: var(--input-focus-bg); }
    [data-theme="dark"] .select-dropdown { background: var(--card-bg); }
    [data-theme="dark"] .podium-card { background: var(--card-bg); }
    [data-theme="dark"] .podium-card.winner { background: var(--ink-2); }
    [data-theme="dark"] .runner-badge {
        background: var(--ink-3);
        color: var(--text-2);
        border-color: var(--border);
    }
    /* Notice block: harden amber text to use CSS var instead of hardcoded hex */
    [data-theme="dark"] .notice-title { color: var(--warm); }
    [data-theme="dark"] .notice-text { color: var(--warm-light); }
    [data-theme="dark"] .no-election-notice {
        background: var(--warm-dim);
        border-left-color: var(--warm);
    }

    /* ══════════════════════════════════════════════════════════
       SYSTEM-DARK MIRRORS — exact copy of every dark rule above
    ══════════════════════════════════════════════════════════ */
    @media (prefers-color-scheme: dark) {
        [data-theme="system"] .desc-card,
        [data-theme="system"] .section-card,
        [data-theme="system"] .sidebar-card,
        [data-theme="system"] .issue-vote-bar,
        [data-theme="system"] .vote-panel,
        [data-theme="system"] .statement-card,
        [data-theme="system"] .ai-card,
        [data-theme="system"] .comments-section,
        [data-theme="system"] .policy-card,
        [data-theme="system"] .feed-empty,
        [data-theme="system"] .timeline-dot,
        [data-theme="system"] .comment-card { background: var(--card-bg); }

        [data-theme="system"] .issue-card:hover,
        [data-theme="system"] .policy-card:hover { background: var(--card-hover-bg); }

        [data-theme="system"] textarea:focus,
        [data-theme="system"] input:focus { background: var(--input-focus-bg) !important; }

        [data-theme="system"] .timeline-dot:not(.active):not(.resolved) {
            background: var(--card-bg);
            border-color: var(--border);
        }
        [data-theme="system"] .claim-item { background: var(--ink-2); }
        [data-theme="system"] .pc-vote-col { background: var(--ink-3); }
        [data-theme="system"] .vote-bar-btn { background: transparent; }
        [data-theme="system"] .vote-bar-btn:hover { background: var(--indigo-dim); }
        [data-theme="system"] .ai-summary-text { background: var(--indigo-dim); }

        /* deo_dashboard.html */
        [data-theme="system"] .action-card { background: var(--card-bg); }
        [data-theme="system"] .action-card:hover { background: var(--card-hover-bg) !important; }
        [data-theme="system"] .responsibilities-card { background: var(--card-bg); }

        /* voter_mgmt.html */
        [data-theme="system"] .voter-table tbody tr:not(.edit-row):hover { background: var(--indigo-dim) !important; }

        /* po_dashboard.html */
        [data-theme="system"] .panel { background: var(--card-bg); }
        [data-theme="system"] .field input[type="text"]:focus,
        [data-theme="system"] .field input[type="number"]:focus,
        [data-theme="system"] .field select:focus { background: var(--input-focus-bg) !important; }
        [data-theme="system"] .otp-input:focus { background: var(--input-focus-bg) !important; }
        [data-theme="system"] .otp-input:not(:placeholder-shown) { background: var(--indigo-dim); }

        /* nomination.html */
        [data-theme="system"] .form-panel { background: var(--card-bg); }
        [data-theme="system"] .form-group input:focus,
        [data-theme="system"] .form-group select:focus { background: var(--input-focus-bg) !important; }
        [data-theme="system"] .select-dropdown { background: var(--card-bg); }
        [data-theme="system"] .select-option:hover,
        [data-theme="system"] .select-option.focused { background: var(--indigo-dim); color: var(--indigo); }

        /* evote_waiting.html */
        [data-theme="system"] .evote-card { background: var(--card-bg); }

        /* verify_vote.html */
        [data-theme="system"] .select-search-box:focus,
        [data-theme="system"] .custom-select-wrap.open .select-search-box { background: var(--input-focus-bg) !important; }
        [data-theme="system"] .select-search-box { background: var(--ink-2); }
        [data-theme="system"] .hash-input:focus { background: var(--input-focus-bg) !important; }
        [data-theme="system"] .result-body { background: var(--card-bg); }
        [data-theme="system"] .custom-select-wrap .select-dropdown { background: var(--card-bg); }

        /* vote.html */
        [data-theme="system"] .vote-card { background: var(--card-bg); }
        [data-theme="system"] .candidate-option input[type="radio"] {
            background: var(--ink-3);
            border-color: var(--border);
        }
        [data-theme="system"] .candidate-option input[type="radio"]:checked {
            background: var(--indigo);
            border-color: var(--indigo);
        }
        [data-theme="system"] .candidate-option:has(input:checked) { background: var(--indigo-dim); }
        [data-theme="system"] .candidate-option:hover { background: var(--ink-2); }

        /* manage_ro.html */
        [data-theme="system"] .table-search { background: var(--ink-2) !important; border-color: var(--border); }

        /* Shared */
        [data-theme="system"] .table-card,
        [data-theme="system"] .result-panel .result-body,
        [data-theme="system"] .evote-card-head,
        [data-theme="system"] .vote-card-head { background: var(--ink-2); }

        /* index.html */
        [data-theme="system"] .chain-block {
            background: var(--card-bg);
            border-color: var(--border);
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }
        [data-theme="system"] .feature-item { background: var(--card-bg); }
        [data-theme="system"] .feature-item:hover { background: var(--card-hover-bg); }
        [data-theme="system"] .role-card { background: var(--card-bg); }
        [data-theme="system"] .role-card:hover { background: var(--card-hover-bg); }
        [data-theme="system"] .step-num {
            background: var(--card-bg);
            border-color: var(--border);
            box-shadow: 0 2px 12px rgba(0,0,0,0.3);
        }
        [data-theme="system"] .process-step:hover .step-num {
            background: var(--indigo);
            border-color: var(--indigo);
        }

        /* about.html */
        [data-theme="system"] .tech-card { background: var(--card-bg); }
        [data-theme="system"] .tech-card:hover { background: var(--card-hover-bg); }
        [data-theme="system"] .timeline-item { background: var(--card-bg); }
        [data-theme="system"] .timeline-item:hover { background: var(--card-hover-bg); }
        [data-theme="system"] .team-card { background: var(--card-bg); }
        [data-theme="system"] .team-card:hover { background: var(--card-hover-bg); }

        /* election_schedule.html */
        [data-theme="system"] .election-card { background: var(--card-bg); }
        [data-theme="system"] .election-card:hover {
            background: var(--card-hover-bg);
            box-shadow: 0 4px 24px rgba(0,0,0,0.3);
        }

        /* election_insights.html */
        [data-theme="system"] .stat-card { background: var(--card-bg); }
        [data-theme="system"] .stat-card:hover { background: var(--card-hover-bg) !important; }
        [data-theme="system"] .stat-cell { background: var(--card-bg); }
        [data-theme="system"] .stat-cell:hover { background: var(--card-hover-bg) !important; }
        [data-theme="system"] .data-table tbody tr:hover { background: var(--indigo-dim) !important; }
        [data-theme="system"] .bento-cell { background: var(--card-bg); }
        [data-theme="system"] .grid-cell { background: var(--card-bg); }
        [data-theme="system"] .full-card { background: var(--card-bg); }

        /* rep_dashboard.html */
        [data-theme="system"] .issue-table tbody tr:hover { background: var(--indigo-dim) !important; }

        /* public_roll.html */
        [data-theme="system"] .roll-table tbody tr:hover { background: var(--indigo-dim) !important; }
        [data-theme="system"] .selection-card { background: var(--card-bg); }

        /* about.html problem/solution list items */
        [data-theme="system"] .list-item:hover { background: var(--indigo-dim) !important; }

        /* rep_dashboard perf card */
        [data-theme="system"] .perf-card { background: var(--indigo-dark); }
        /* ── rep_accountability.html ── */
        [data-theme="system"] .acc-score-strip           { background: var(--card-bg); }
        [data-theme="system"] .acc-strip-item            { background: var(--card-bg); border-color: var(--border); }
        [data-theme="system"] .dim-card                  { background: var(--card-bg); }
        [data-theme="system"] .dim-card-head             { background: var(--ink-2); }
        [data-theme="system"] .dim-icon                  { background: var(--ink-3); border-color: var(--border); }
        [data-theme="system"] .dim-weight                { background: var(--ink-3); }
        [data-theme="system"] .avg-card                  { background: var(--card-bg); }
        [data-theme="system"] .avg-card-head             { background: var(--ink-2); }
        [data-theme="system"] .avg-score-big             { background: var(--ink-2); border-color: var(--border); }
        [data-theme="system"] .formula-card              { background: var(--ink-2); }
        [data-theme="system"] .acc-alert.warn            { background: var(--warm-dim); }
        [data-theme="system"] .acc-alert.pre-danger      { background: rgba(234,88,12,0.12); }
        [data-theme="system"] .acc-alert.danger          { background: rgba(220,38,38,0.12); }
        [data-theme="system"] .acc-body                  { background: var(--ink-2); }
        [data-theme="system"] .flow-num                  { background: var(--ink-2); border-color: var(--border); }
        [data-theme="system"] .flow-num.active           { background: var(--indigo); border-color: var(--indigo); }

        /* ── my_issues.html ── */
        [data-theme="system"] .my-stat                   { background: var(--card-bg); }
        [data-theme="system"] .my-stat:hover             { background: var(--card-hover-bg) !important; }
        [data-theme="system"] .issue-card                { background: var(--card-bg); }
        [data-theme="system"] .issue-card:hover          { background: var(--card-hover-bg) !important; }
        [data-theme="system"] .vote-column               { background: var(--ink-2); border-color: var(--border); }

        /* ── audit_logs.html ── */
        [data-theme="system"] .audit-stat                { background: var(--card-bg); }
        [data-theme="system"] .audit-stat:hover          { background: var(--card-hover-bg) !important; }
        [data-theme="system"] .audit-table tbody tr:hover { background: var(--indigo-dim) !important; }

        /* ── manage_ceo.html ── */
        [data-theme="system"] .ceo-stat                  { background: var(--card-bg); }
        [data-theme="system"] .ceo-stat:hover            { background: var(--card-hover-bg) !important; }
        [data-theme="system"] .data-table tbody tr:hover { background: var(--indigo-dim) !important; }
        [data-theme="system"] .state-tag                 { background: var(--ink-2); border-color: var(--border); color: var(--text); }
        [data-theme="system"] .filter-tabs               { border-color: var(--border); }
        [data-theme="system"] .filter-tab                { background: var(--ink-2); color: var(--muted); border-color: var(--border); }
        [data-theme="system"] .filter-tab:hover          { background: var(--indigo-dim); color: var(--indigo); }
        [data-theme="system"] .filter-tab.active         { background: var(--indigo); color: #fff; }

        /* ── notifications.html ── */
        [data-theme="system"] .notif-item                { background: var(--card-bg); }
        [data-theme="system"] .notif-item:hover          { background: var(--card-hover-bg); }
        [data-theme="system"] .notif-icon-col            { background: var(--ink-2); border-color: var(--border); }
        [data-theme="system"] .notif-icon                { background: var(--ink-3); border-color: var(--border); }
        [data-theme="system"] .notif-empty               { background: var(--card-bg); }
        [data-theme="system"] .notif-empty-title         { color: var(--text); }

        /* ── create_election.html ── */
        [data-theme="system"] .form-main                 { background: var(--card-bg); }
        [data-theme="system"] .form-section              { background: var(--card-bg); }
        [data-theme="system"] .form-actions-bar          { background: var(--ink-2); }
        [data-theme="system"] .sidebar-card-head         { background: var(--ink-2); }
        [data-theme="system"] .checkbox-item             { background: var(--card-bg); color: var(--text); }
        [data-theme="system"] .checkbox-item:hover       { background: var(--indigo-dim); color: var(--indigo); }
        [data-theme="system"] .checkbox-item input[type="checkbox"] {
            background: var(--ink-3);
            border-color: var(--border);
        }
        [data-theme="system"] .checkbox-item input[type="checkbox"]:checked {
            background: var(--indigo);
            border-color: var(--indigo);
        }
        [data-theme="system"] .constituency-grid         { background: var(--border); border-color: var(--border); }
        [data-theme="system"] .constituency-search       { background: var(--ink-2); color: var(--text); border-color: var(--border); }
        [data-theme="system"] .constituency-search:focus { border-color: var(--indigo); }

        /* ── blo_voter_verification.html ── */
        [data-theme="system"] .voter-table               { background: var(--card-bg); }
        [data-theme="system"] .voter-table thead         { background: var(--ink-2); }
        [data-theme="system"] .voter-table-wrap          { border-color: var(--border); }
        [data-theme="system"] .voter-table tbody tr:hover { background: var(--indigo-dim) !important; }
        [data-theme="system"] .blo-stat                  { background: var(--card-bg); border-color: var(--border); }
        [data-theme="system"] .voter-avatar-placeholder  { background: var(--indigo-dim); }
        [data-theme="system"] .search-input              { background: var(--ink-2); border-color: var(--border); color: var(--text); }
        [data-theme="system"] .search-input:focus        { background: var(--input-focus-bg) !important; }
        [data-theme="system"] .sort-btn                  { background: var(--ink-2); border-color: var(--border); color: var(--muted); }
        [data-theme="system"] .sort-btn:hover            { background: var(--indigo-dim); border-color: var(--indigo); color: var(--indigo); }
        [data-theme="system"] .sort-btn.active           { background: var(--indigo); border-color: var(--indigo); color: #fff; }
        [data-theme="system"] .file-input-label          { border-color: var(--border); color: var(--muted); }
        [data-theme="system"] .file-input-label:hover    { background: var(--indigo-dim); border-color: var(--indigo); color: var(--indigo); }
        [data-theme="system"] .blo-info-banner           { background: var(--indigo-dim); border-color: rgba(129,140,248,0.25); }

        /* ── election_insights.html ── */
        [data-theme="system"] .hero-selector             { background: var(--ink-2); border-color: var(--border); }
        [data-theme="system"] .hero-selector-label       { background: var(--ink-3); color: var(--muted); border-color: var(--border); }
       [data-theme="system"] .hero-selector-wrap select {
    background: var(--ink-2) !important;
    color: var(--text);
}
/* inside @media (prefers-color-scheme: dark) */
[data-theme="system"] .hero-selector-wrap { color-scheme: dark; }
        [data-theme="system"] .stat-card                 { background: var(--card-bg); }
        [data-theme="system"] .stat-card:hover           { background: var(--card-hover-bg) !important; }


        /* Native selects */
        /* policy_detail.html textarea focus */
        [data-theme="system"] .counter-form-wrap textarea:focus { background: var(--input-focus-bg) !important; }
        [data-theme="system"] .new-comment-form textarea:focus  { background: var(--input-focus-bg) !important; }
        [data-theme="system"] .reply-input-wrap textarea:focus  { background: var(--input-focus-bg) !important; }
        [data-theme="system"] .reply-input-row textarea:focus   { background: var(--input-focus-bg) !important; }

                [data-theme="system"] select {
            background: var(--ink-2);
            color: var(--text);
            border-color: var(--border);
        }
        [data-theme="system"] select:focus { background: var(--input-focus-bg); }
        /* live_results.html */
        [data-theme="system"] .results-selector-strip { background: var(--card-bg); }
        [data-theme="system"] .selector-wrap select {
            background: var(--ink-2);
            color: var(--text);
            border-color: var(--border);
        }
        [data-theme="system"] .selector-wrap select:focus { background: var(--input-focus-bg); }
        [data-theme="system"] .results-prompt { background: var(--card-bg); }
        [data-theme="system"] .results-summary { background: var(--card-bg); }
        [data-theme="system"] .results-chart { background: var(--card-bg); }

        /* no_election.html */
        [data-theme="system"] .no-election-card { background: var(--card-bg); }
        [data-theme="system"] .back-btn { background: var(--ink-2); color: var(--text); }
        [data-theme="system"] .back-btn:hover { background: var(--card-hover-bg); }

        /* results_dashboard.html */
        [data-theme="system"] .select-search-box { background: var(--ink-2); }
        [data-theme="system"] .select-search-box.open,
        [data-theme="system"] .select-search-box:focus { background: var(--input-focus-bg); }
        [data-theme="system"] .select-dropdown { background: var(--card-bg); }
        [data-theme="system"] .podium-card { background: var(--card-bg); }
        [data-theme="system"] .podium-card.winner { background: var(--ink-2); }
        [data-theme="system"] .runner-badge {
            background: var(--ink-3);
            color: var(--text-2);
            border-color: var(--border);
        }
        [data-theme="system"] .notice-title { color: var(--warm); }
        [data-theme="system"] .notice-text { color: var(--warm-light); }
        [data-theme="system"] .no-election-notice {
            background: var(--warm-dim);
            border-left-color: var(--warm);
        }
         [data-theme="system"] .stat-card:hover           { background: var(--card-hover-bg) !important; }
        [data-theme="system"] .data-table tbody tr:hover { background: var(--indigo-dim) !important; }

        /* representatives.html — rep card hover */
        [data-theme="system"] .rep-card:hover            { background: var(--card-hover-bg) !important; box-shadow: 0 8px 40px rgba(0,0,0,0.3); }
        [data-theme="system"] .stat-card:hover           { background: var(--card-hover-bg) !important; }
        [data-theme="system"] .data-table tbody tr:hover { background: var(--indigo-dim) !important; }

        /* representatives.html — rep card hover */
        [data-theme="system"] .rep-card:hover            { background: var(--card-hover-bg) !important; box-shadow: 0 8px 40px rgba(0,0,0,0.3); }

    }

    html { scroll-behavior: smooth; }

    body {
        background: var(--ink);
        color: var(--text);
        font-family: var(--font-body);
        font-weight: 400;
        line-height: 1.6;
        overflow-x: hidden;
        cursor: none;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        font-size: 16px;
    }
    body.sidebar-open { overflow: hidden; }

    /* Noise overlay */
    body::before {
        content: '';
        position: fixed; inset: 0;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='1'/%3E%3C/svg%3E");
        opacity: 0.025;
        pointer-events: none;
        z-index: 1;
        transition: none;
    }

    /* ═══ CUSTOM CURSOR ═══ */
    .cursor-dot,
    .cursor-ring {
        position: fixed; top: 0; left: 0; border-radius: 50%;
        pointer-events: none; z-index: 9999;
        transform: translate(-50%, -50%);
        transition: none;
    }
    .cursor-dot {
        width: 6px; height: 6px;
        background: var(--indigo);
    }
    .cursor-ring {
        width: 34px; height: 34px;
        border: 1.5px solid color-mix(in srgb, var(--indigo) 40%, transparent);
        transition: width .2s ease, height .2s ease, border-color .2s ease, background .2s ease;
    }
    body:has(a:hover) .cursor-ring,
    body:has(button:hover) .cursor-ring {
        width: 52px; height: 52px;
        border-color: var(--indigo);
        background: var(--indigo-dim);
    }

    /* ═══ NAVBAR ═══ */
    .navbar {
        position: fixed; top: 0; left: 0; right: 0; z-index: 200;
        height: var(--nav-h);
        display: flex; align-items: center; justify-content: space-between;
        padding: 0 2.5rem 0 1.2rem;
        border-bottom: 1px solid transparent;
        transition:
            background-color .35s ease,
            border-color     .35s ease,
            box-shadow       .35s ease;
        will-change: background-color;
    }
    .navbar.scrolled {
        background: var(--nav-scrolled-bg);
        backdrop-filter: blur(20px) saturate(160%);
        -webkit-backdrop-filter: blur(20px) saturate(160%);
        border-color: var(--border);
        box-shadow: 0 1px 40px rgba(30,40,80,0.08);
    }

    /* Hamburger */
    .hamburger {
        width: 48px; height: 48px;
        background: none; border: 1px solid transparent;
        display: flex; flex-direction: column; align-items: center;
        justify-content: center; gap: 5px;
        cursor: pointer; padding: 10px; border-radius: 6px;
        transition: background .2s, border-color .2s;
        flex-shrink: 0; position: relative; z-index: 201;
    }
    .hamburger:hover { background: var(--indigo-dim); border-color: var(--border); }
    .hamburger span {
        display: block; width: 22px; height: 2px;
        background: var(--text); border-radius: 2px;
        transform-origin: center;
        transition: transform .35s cubic-bezier(.23,1,.32,1), opacity .25s, width .3s, background-color .2s;
    }
    .hamburger:hover span { background: var(--indigo); }
    .hamburger.active span:nth-child(1) { transform: translateY(7px) rotate(45deg); }
    .hamburger.active span:nth-child(2) { opacity: 0; width: 0; }
    .hamburger.active span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }

    /* Logo */
    .navbar-logo-wrap {
        display: flex; align-items: center;
        margin-left: 0.4rem; flex: 1;
    }
    .logo {
        display: flex; align-items: center;
        gap: 0.85rem; text-decoration: none; position: relative;
    }

    .logo-mark { position: relative; width: 44px; height: 44px; flex-shrink: 0; }
    .logo-mark svg.hex-bg {
        position: absolute; inset: 0; width: 100%; height: 100%;
        animation: logo-rotate 18s linear infinite;
        transform-origin: center;
        transition: none;
    }
    .logo-mark svg.hex-inner {
        position: absolute; inset: 10px;
        width: calc(100% - 20px); height: calc(100% - 20px);
        animation: logo-rotate-rev 12s linear infinite;
        transform-origin: center;
        transition: none;
    }
    .logo-mark .logo-core {
        position: absolute; inset: 0;
        display: flex; align-items: center; justify-content: center;
    }
    .logo-mark .logo-core svg {
        width: 16px; height: 16px;
        fill: var(--indigo);
        transition: fill .25s ease;
    }

    @keyframes logo-rotate     { from{transform:rotate(0deg)}  to{transform:rotate(360deg)} }
    @keyframes logo-rotate-rev { from{transform:rotate(0deg)}  to{transform:rotate(-360deg)} }

    .logo-wordmark { display: flex; flex-direction: column; line-height: 1; gap: 1px; }
    .logo-wordmark-top {
        font-family: var(--font-disp); font-size: 1.45rem;
        letter-spacing: 0.06em; color: var(--indigo); line-height: 1;
    }
    .logo-wordmark-bottom {
        font-family: var(--font-mono); font-size: 0.58rem;
        letter-spacing: 0.3em; text-transform: uppercase; color: var(--muted); line-height: 1;
    }
    .logo-pip {
        display: inline-block; width: 5px; height: 5px; border-radius: 50%;
        background: var(--warm); margin-left: 2px; vertical-align: middle;
        animation: pip-pulse 2s ease-in-out infinite;
        transition: background-color .25s ease;
    }
    @keyframes pip-pulse {
        0%,100% { box-shadow: 0 0 0 0 rgba(245,158,11,0.6); }
        50%      { box-shadow: 0 0 0 5px rgba(245,158,11,0); }
    }

    /* Nav right */
    .navbar-right { display: flex; align-items: center; gap: 1rem; flex-shrink: 0; }
    .nav-user-badge {
        font-family: var(--font-mono); font-size: .72rem; font-weight: 600;
        letter-spacing: .12em; text-transform: uppercase;
        color: var(--teal); background: var(--teal-dim);
        border: 1px solid rgba(13,148,136,.3); padding: .35rem .9rem; border-radius: 2px;
    }
    .nav-profile-link {
        display: inline-flex; align-items: center; justify-content: center;
        width: 36px; height: 36px; border-radius: 50%;
        border: 1.5px solid rgba(79,70,229,0.25);
        background: var(--indigo-dim); text-decoration: none; color: var(--indigo);
        transition: background .2s, border-color .2s, transform .2s, box-shadow .2s;
        flex-shrink: 0;
    }
    .nav-profile-link:hover {
        background: var(--indigo-mid); border-color: var(--indigo);
        transform: scale(1.08); box-shadow: 0 0 0 4px rgba(79,70,229,0.12);
    }
    .nav-profile-link svg {
        width: 16px; height: 16px; stroke: currentColor; fill: none;
        stroke-width: 1.8; stroke-linecap: round; stroke-linejoin: round;
    }
    .nav-cta {
        font-family: var(--font-mono); font-size: .78rem; font-weight: 700;
        letter-spacing: .12em; text-transform: uppercase;
        background: var(--indigo); color: #fff; padding: .65rem 1.6rem;
        text-decoration: none;
        clip-path: polygon(8px 0%, 100% 0%, calc(100% - 8px) 100%, 0% 100%);
        transition: background-color .2s, transform .2s;
        display: inline-block;
    }
    .nav-cta:hover { background: var(--indigo-dark); transform: translateY(-1px); }

    /* ═══ SIDEBAR OVERLAY ═══ */
    .sidebar-overlay {
        position: fixed; inset: 0;
        background: rgba(15,15,20,.55);
        backdrop-filter: blur(4px);
        z-index: 299; opacity: 0; pointer-events: none;
        transition: opacity .4s ease;
    }
    .sidebar-overlay.active { opacity: 1; pointer-events: all; }

    /* ═══ SIDEBAR DRAWER ═══ */
    .sidebar {
        position: fixed; top: 0; left: 0;
        width: var(--sidebar-w); height: 100vh;
        background: var(--sidebar-bg); z-index: 300;
        display: flex; flex-direction: column;
        transform: translateX(-100%);
        transition: transform .42s cubic-bezier(.23,1,.32,1), background-color .25s ease;
        border-right: 1px solid var(--border);
        overflow-y: auto;
    }
    .sidebar.active { transform: translateX(0); }

    .sidebar-header {
        display: flex; align-items: center; justify-content: space-between;
        padding: 1.5rem 1.75rem;
        border-bottom: 1px solid var(--border);
        min-height: var(--nav-h); flex-shrink: 0;
    }
    .sidebar-logo {
        font-family: var(--font-mono); font-size: .72rem; font-weight: 700;
        letter-spacing: .2em; text-transform: uppercase; color: var(--indigo);
    }
    .sidebar-close {
        width: 36px; height: 36px; background: var(--ink-2);
        border: 1px solid var(--border); border-radius: 50%;
        display: grid; place-items: center; cursor: pointer;
        transition: background-color .2s, border-color .2s;
    }
    .sidebar-close:hover { background: var(--indigo-dim); border-color: var(--indigo); }
    .sidebar-close svg { width: 14px; height: 14px; stroke: var(--muted); stroke-width: 2; fill: none; }
    .sidebar-close:hover svg { stroke: var(--indigo); }

    .sidebar-section-label {
        font-family: var(--font-mono); font-size: .6rem; font-weight: 700;
        letter-spacing: .25em; text-transform: uppercase;
        color: var(--muted); padding: 1.5rem 1.75rem .6rem;
    }

    .sidebar-nav { list-style: none; padding: 0 .9rem; }
    .sidebar-nav li { border-bottom: 1px solid rgba(79,70,229,.06); }
    .sidebar-nav li:last-child { border-bottom: none; }
    .sidebar-nav a {
        display: flex; align-items: center; gap: .9rem;
        padding: .85rem .75rem; text-decoration: none; border-radius: 5px;
        transition: background-color .15s, color .15s;
        font-family: var(--font-body); font-size: .97rem; font-weight: 500;
        color: var(--text-2);
    }
    .sidebar-nav a:hover { background: var(--indigo-dim); color: var(--indigo); }

    .nav-icon {
        width: 34px; height: 34px; flex-shrink: 0;
        background: var(--ink-2); border: 1px solid var(--border);
        border-radius: 5px; display: grid; place-items: center;
        transition: background-color .15s, border-color .15s;
    }
    .sidebar-nav a:hover .nav-icon { background: var(--indigo-dim); border-color: rgba(79,70,229,.25); }
    .nav-icon svg {
        width: 15px; height: 15px; stroke: var(--muted); fill: none;
        stroke-width: 1.8; stroke-linecap: round; stroke-linejoin: round;
        transition: stroke .15s;
    }
    .sidebar-nav a:hover .nav-icon svg { stroke: var(--indigo); }

    .nav-label { flex: 1; font-size: .95rem; }
    .nav-arrow {
        font-size: .8rem; color: var(--muted);
        opacity: 0; transform: translateX(-4px);
        transition: opacity .15s, transform .15s;
    }
    .sidebar-nav a:hover .nav-arrow { opacity: 1; transform: translateX(0); }

    .ext-badge {
        font-family: var(--font-mono); font-size: .58rem; font-weight: 700;
        letter-spacing: .1em; color: var(--teal);
        background: var(--teal-dim); border: 1px solid rgba(13,148,136,.25);
        padding: .15rem .45rem; border-radius: 2px;
    }

    /* ═══ THEME TOGGLE ═══ */
    .theme-toggle-wrap {
        padding: 1rem 1.75rem;
        border-top: 1px solid var(--border);
        flex-shrink: 0;
    }
    .theme-toggle-label {
        font-family: var(--font-mono); font-size: .6rem; font-weight: 700;
        letter-spacing: .25em; text-transform: uppercase;
        color: var(--muted); margin-bottom: .75rem; display: block;
    }
    .theme-toggle {
        display: grid; grid-template-columns: 1fr 1fr 1fr;
        gap: 3px;
        background: var(--ink-2);
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 3px;
    }
    .theme-btn {
        display: flex; align-items: center; justify-content: center; gap: .4rem;
        padding: .55rem .5rem;
        font-family: var(--font-mono); font-size: .65rem; font-weight: 600;
        letter-spacing: .08em; text-transform: uppercase;
        color: var(--muted);
        background: transparent; border: none; border-radius: 4px;
        cursor: pointer;
        transition: background-color .2s, color .2s;
    }
    .theme-btn svg {
        width: 12px; height: 12px; stroke: currentColor; fill: none;
        stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;
        flex-shrink: 0;
        transition: stroke .2s;
    }
    .theme-btn:hover { color: var(--indigo); }
    .theme-btn.active {
        background: var(--indigo);
        color: #fff;
    }
    .theme-btn.active svg { stroke: #fff; }

    /* ═══ SIDEBAR FOOTER ═══ */
    .sidebar-footer {
        padding: 1.5rem 1.75rem;
        border-top: 1px solid var(--border); flex-shrink: 0;
    }
    .sidebar-cta {
        display: flex; align-items: center; justify-content: center; gap: .5rem;
        width: 100%; padding: .95rem 1.5rem;
        font-family: var(--font-mono); font-size: .8rem; font-weight: 700;
        letter-spacing: .12em; text-transform: uppercase;
        background: var(--indigo); color: #fff; text-decoration: none;
        clip-path: polygon(10px 0%, 100% 0%, calc(100% - 10px) 100%, 0% 100%);
        transition: background-color .2s;
    }
    .sidebar-cta:hover { background: var(--indigo-dark); }
    .sidebar-meta {
        margin-top: 1rem; font-family: var(--font-mono); font-size: .62rem;
        font-weight: 500; letter-spacing: .1em; text-transform: uppercase;
        color: var(--muted); text-align: center; line-height: 1.7;
    }
    .sidebar-meta a { color: var(--teal); text-decoration: none; }
    .sidebar-meta a:hover { text-decoration: underline; }

    /* ═══ FLASH ═══ */
    .flash-container {
        position: fixed; top: calc(var(--nav-h) + 1rem); right: 1.5rem;
        z-index: 800; display: flex; flex-direction: column; gap: .5rem; max-width: 400px;
    }
    .flash {
        padding: 1rem 1.4rem; border-left: 3px solid var(--indigo);
        background: var(--ink); backdrop-filter: blur(12px);
        font-family: var(--font-mono); font-size: .78rem; font-weight: 500;
        letter-spacing: .04em; color: var(--text);
        box-shadow: 0 4px 24px rgba(30,40,80,.12);
        border-radius: 0 3px 3px 0; animation: flash-in .3s ease forwards;
    }
    .flash.success { border-color: var(--teal); }
    .flash.error   { border-color: #dc2626; }
    .flash.warning { border-color: var(--warm); }
    .flash.info    { border-color: var(--indigo); }

    /* ═══ PAGE BODY ═══ */
    .page-body { flex: 1; padding-top: var(--nav-h); }

    /* ═══ BUTTONS ═══ */
    .btn-primary {
        display: inline-flex; align-items: center; gap: .5rem;
        font-family: var(--font-mono); font-size: .82rem; font-weight: 700;
        letter-spacing: .12em; text-transform: uppercase;
        background: var(--indigo); color: #fff; text-decoration: none;
        padding: 1rem 2.2rem;
        clip-path: polygon(10px 0%, 100% 0%, calc(100% - 10px) 100%, 0% 100%);
        transition: background-color .2s, transform .2s;
        position: relative; overflow: hidden; border: none; cursor: pointer;
    }
    .btn-primary::before {
        content: ''; position: absolute; inset: 0;
        background: linear-gradient(120deg, transparent 40%, rgba(255,255,255,.2) 50%, transparent 60%);
        transform: translateX(-100%); transition: transform .4s;
    }
    .btn-primary:hover::before { transform: translateX(100%); }
    .btn-primary:hover { background: var(--indigo-dark); transform: translateY(-2px); }
    .btn-primary.btn-large { padding: 1.15rem 2.8rem; font-size: .85rem; }

    .btn-outline {
        display: inline-flex; align-items: center; gap: .5rem;
        font-family: var(--font-mono); font-size: .8rem; font-weight: 600;
        letter-spacing: .12em; text-transform: uppercase;
        background: transparent; color: var(--text); text-decoration: none;
        padding: .95rem 1.8rem; border: 1.5px solid var(--border);
        transition: border-color .2s, color .2s;
        position: relative; overflow: hidden; cursor: pointer;
    }
    .btn-outline::before {
        content: ''; position: absolute; inset: 0; background: var(--indigo-dim);
        transform: scaleX(0); transform-origin: left; transition: transform .25s ease; z-index: 0;
    }
    .btn-outline span { position: relative; z-index: 1; }
    .btn-outline:hover { border-color: var(--indigo); color: var(--indigo); }
    .btn-outline:hover::before { transform: scaleX(1); }

    .btn-ghost {
        display: inline-flex; align-items: center; gap: .5rem;
        font-family: var(--font-mono); font-size: .8rem; font-weight: 600;
        letter-spacing: .1em; text-transform: uppercase;
        background: transparent; color: var(--muted); text-decoration: none;
        padding: .95rem 1rem; border: none; cursor: pointer; transition: color .2s;
    }
    .btn-ghost:hover { color: var(--indigo); }
    .btn-ghost svg { transition: transform .2s; }
    .btn-ghost:hover svg { transform: translateX(3px) translateY(-3px); }

    /* ═══ FOOTER ═══ */
    .footer {
        border-top: 1px solid var(--border); padding: 2.5rem 4rem;
        display: flex; align-items: center; justify-content: space-between;
        background: var(--ink-2);
    }
    .footer-copy {
        font-family: var(--font-mono); font-size: .72rem; font-weight: 500;
        letter-spacing: .1em; color: var(--muted); text-transform: uppercase;
    }
    .footer-links { display: flex; gap: 2.5rem; list-style: none; }
    .footer-links a {
        font-family: var(--font-mono); font-size: .72rem; font-weight: 600;
        letter-spacing: .1em; text-transform: uppercase; color: var(--muted);
        text-decoration: none; transition: color .2s;
    }
    .footer-links a:hover { color: var(--indigo); }

    /* ═══ UTILITIES ═══ */
    .reveal { opacity: 0; transform: translateY(28px); transition: opacity .7s ease, transform .7s ease; }
    .reveal.visible { opacity: 1; transform: none; }
    .section { padding: 7rem 4rem; }
    .section-tag {
        display: inline-flex; align-items: center; gap: .6rem;
        font-family: var(--font-mono); font-size: .72rem; font-weight: 600;
        letter-spacing: .22em; text-transform: uppercase; color: var(--indigo); margin-bottom: 1.2rem;
    }
    .section-tag::before { content: ''; width: 24px; height: 1.5px; background: var(--indigo); }
    .section-title {
        font-family: var(--font-disp); font-size: clamp(2.8rem,5.5vw,5rem);
        line-height: .93; margin-bottom: 1.5rem; color: var(--text); letter-spacing: .01em;
    }

    /* ═══ KEYFRAMES ═══ */
    @keyframes fade-up      { from{opacity:0;transform:translateY(24px)} to{opacity:1;transform:translateY(0)} }
    @keyframes float        { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
    @keyframes blink        { 0%,100%{opacity:1} 50%{opacity:.3} }
    @keyframes pulse-ring   { 0%,100%{transform:scale(1);opacity:.8} 50%{transform:scale(1.3);opacity:.3} }
    @keyframes ticker-scroll{ 0%{transform:translateX(0)} 100%{transform:translateX(-50%)} }
    @keyframes flash-in     { from{opacity:0;transform:translateX(12px)} to{opacity:1;transform:translateX(0)} }

    /* ═══ REDUCED MOTION SUPPORT ═══ */
    @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
            animation-duration: .01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: .01ms !important;
        }
        .reveal { opacity: 1; transform: none; }
    }

    @media (max-width: 900px) {
        .navbar { padding: 0 1.2rem 0 1rem; }
        .logo-wordmark-bottom { display: none; }
        .section { padding: 5rem 2rem; }
        .footer { flex-direction: column; gap: 1.2rem; text-align: center; padding: 2.5rem 2rem; }
    }
    </style>

    {% block extra_css %}{% endblock %}
</head>
<body>

    <div class="cursor-dot"  id="cursorDot"></div>
    <div class="cursor-ring" id="cursorRing"></div>

    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- ═══ SIDEBAR ═══ -->
    <aside class="sidebar" id="sidebar" role="navigation" aria-label="Site navigation">
        <div class="sidebar-header">
            <span class="sidebar-logo">Navigation</span>
            <button class="sidebar-close" id="sidebarClose" aria-label="Close menu">
                <svg viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>
            </button>
        </div>

        <p class="sidebar-section-label">Pages</p>
        <ul class="sidebar-nav">
            <li>
                <a href="/">
                    <span class="nav-icon"><svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></span>
                    <span class="nav-label">Home</span>
                    <span class="nav-arrow">→</span>
                </a>
            </li>
            <li>
                <a href="{{ url_for('public.election_schedule') }}">
                    <span class="nav-icon"><svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></span>
                    <span class="nav-label">Election Schedule</span>
                    <span class="nav-arrow">→</span>
                </a>
            </li>
            <li>
                <a href="{{ url_for('public_results.dashboard') }}">
                    <span class="nav-icon"><svg viewBox="0 0 24 24"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg></span>
                    <span class="nav-label">Results Dashboard</span>
                    <span class="nav-arrow">→</span>
                </a>
            </li>
            <li>
                <a href="{{ url_for('public.election_dashboard') }}">
                    <span class="nav-icon"><svg viewBox="0 0 24 24"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg></span>
                    <span class="nav-label">Election Insights</span>
                    <span class="nav-arrow">→</span>
                </a>
            </li>
            <li>
                <a href="{{ url_for('verify_vote.verify_vote_page') }}">
                    <span class="nav-icon"><svg viewBox="0 0 24 24"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg></span>
                    <span class="nav-label">Verify My Vote</span>
                    <span class="nav-arrow">→</span>
                </a>
            </li>
            <li>
                <a href="/commission/public/roll">
                    <span class="nav-icon"><svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg></span>
                    <span class="nav-label">Voter Roll</span>
                    <span class="nav-arrow">→</span>
                </a>
            </li>
            {% if session.get("role") == "CITIZEN" %}
            <li>
                <a href="{{ url_for('citizen.profile') }}">
                    <span class="nav-icon"><svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></span>
                    <span class="nav-label">My Profile</span>
                    <span class="nav-arrow">→</span>
                </a>
            </li>
            {% endif %}
        </ul>

        <p class="sidebar-section-label">External</p>
        <ul class="sidebar-nav">
            <li>
                <a href="https://sepolia.etherscan.io/address/0x51bE814c9F2C2ec5799fA872A25A0735723fae0e" target="_blank" rel="noopener noreferrer">
                    <span class="nav-icon"><svg viewBox="0 0 24 24"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg></span>
                    <span class="nav-label">Smart Contract</span>
                    <span class="ext-badge">↗ Etherscan</span>
                </a>
            </li>
        </ul>

        <!-- ═══ THEME TOGGLE ═══ -->
        <div class="theme-toggle-wrap">
            <span class="theme-toggle-label">Appearance</span>
            <div class="theme-toggle" role="group" aria-label="Choose theme">
                <button class="theme-btn" id="btn-light" data-theme="light" onclick="setTheme('light')" title="Light mode">
                    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
                    Light
                </button>
                <button class="theme-btn" id="btn-system" data-theme="system" onclick="setTheme('system')" title="Follow device">
                    <svg viewBox="0 0 24 24"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
                    Auto
                </button>
                <button class="theme-btn" id="btn-dark" data-theme="dark" onclick="setTheme('dark')" title="Dark mode">
                    <svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                    Dark
                </button>
            </div>
        </div>

        <div class="sidebar-footer">
            {% if session.get("user_id") %}
                <div class="nav-user-badge" style="text-align:center;margin-bottom:1rem;display:block;border-radius:3px;">
                    Signed in as {{ session.get("role") }}
                </div>
                <a href="{{ url_for('auth.logout') }}" class="sidebar-cta">Logout →</a>
            {% else %}
                <a href="{{ url_for('auth.login') }}" class="sidebar-cta">Login to Platform →</a>
            {% endif %}
            <p class="sidebar-meta">
                E-Democracy Platform &nbsp;·&nbsp;
                <a href="{{ url_for('public.about') }}">About</a>
            </p>
        </div>
    </aside>

    <!-- ═══ NAVBAR ═══ -->
    <header class="navbar" id="mainNav">
        <button class="hamburger" id="hamburger" aria-label="Open navigation" aria-expanded="false" aria-controls="sidebar">
            <span></span><span></span><span></span>
        </button>

        <div class="navbar-logo-wrap">
            <a href="/" class="logo">
                <div class="logo-mark">
                    <svg class="hex-bg" viewBox="0 0 44 44" fill="none">
                        <polygon points="22,2 40,12 40,32 22,42 4,32 4,12"
                                 fill="none" stroke="rgba(79,70,229,0.22)"
                                 stroke-width="1" stroke-dasharray="3 3"/>
                    </svg>
                    <svg class="hex-inner" viewBox="0 0 24 24" fill="none">
                        <polygon points="12,1 21.5,6.5 21.5,17.5 12,23 2.5,17.5 2.5,6.5"
                                 fill="rgba(79,70,229,0.1)" stroke="rgba(79,70,229,0.5)" stroke-width="1.5"/>
                    </svg>
                    <div class="logo-core">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                </div>
                <div class="logo-wordmark">
                    <span class="logo-wordmark-top">E-Democracy<span class="logo-pip"></span></span>
                    <span class="logo-wordmark-bottom">Civic&nbsp;Blockchain&nbsp;Platform</span>
                </div>
            </a>
        </div>

        <div class="navbar-right">
            {% if session.get("user_id") %}
                <span class="nav-user-badge">{{ session.get("role") }}</span>
                {% if session.get("role") == "CITIZEN" %}
                    <a href="{{ url_for('citizen.profile') }}" class="nav-profile-link" title="My Profile">
                        <svg viewBox="0 0 24 24">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                    </a>
                {% endif %}
            {% else %}
                <a href="{{ url_for('auth.login') }}" class="nav-cta">Login →</a>
            {% endif %}
        </div>
    </header>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-container">
                {% for category, message in messages %}
                    <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <div class="page-body">
        {% block content %}{% endblock %}
    </div>

    <footer class="footer">
        <span class="footer-copy">© {{ current_year if current_year else "2026" }} E-Democracy Platform · AI–Blockchain Integrated System</span>
        <ul class="footer-links">
            <li><a href="{{ url_for('public.election_schedule') }}">Schedule</a></li>
            <li><a href="{{ url_for('public_results.dashboard') }}">Results</a></li>
            <li><a href="{{ url_for('verify_vote.verify_vote_page') }}">Verify</a></li>
            <li><a href="https://sepolia.etherscan.io/address/0x51bE814c9F2C2ec5799fA872A25A0735723fae0e" target="_blank">Contract ↗</a></li>
        </ul>
    </footer>

    <script>
        /* ─── THEME ─────────────────────────────────────────── */
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.theme === theme);
            });
        }

        (function(){
            var current = localStorage.getItem('theme') || 'system';
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.theme === current);
            });
        })();

        /* ─── CUSTOM CURSOR ─────────────────────────────────── */
        const cursorDot  = document.getElementById('cursorDot');
        const cursorRing = document.getElementById('cursorRing');
        let mx=0, my=0, rx=0, ry=0;

        document.addEventListener('mousemove', e => { mx = e.clientX; my = e.clientY; });

        (function tick(){
            rx += (mx - rx) * .14;
            ry += (my - ry) * .14;
            cursorDot.style.transform  = `translate(calc(${mx}px - 50%), calc(${my}px - 50%))`;
            cursorRing.style.transform = `translate(calc(${rx}px - 50%), calc(${ry}px - 50%))`;
            requestAnimationFrame(tick);
        })();

        /* ─── STICKY NAV ────────────────────────────────────── */
        const mainNav = document.getElementById('mainNav');
        window.addEventListener('scroll', () => {
            mainNav.classList.toggle('scrolled', window.scrollY > 40);
        }, { passive: true });

        /* ─── SIDEBAR ───────────────────────────────────────── */
        const hamburger = document.getElementById('hamburger');
        const sidebar   = document.getElementById('sidebar');
        const overlay   = document.getElementById('sidebarOverlay');
        const closeBtn  = document.getElementById('sidebarClose');

        function openSidebar() {
            sidebar.classList.add('active');
            overlay.classList.add('active');
            hamburger.classList.add('active');
            hamburger.setAttribute('aria-expanded', 'true');
            document.body.classList.add('sidebar-open');
            sidebar.querySelectorAll('.sidebar-nav a').forEach((el, i) => {
                el.style.opacity = '0';
                el.style.transform = 'translateX(-12px)';
                el.style.transition = 'none';
                setTimeout(() => {
                    el.style.transition = 'opacity .3s ease, transform .3s ease, background-color .15s, color .15s';
                    el.style.opacity    = '1';
                    el.style.transform  = 'translateX(0)';
                }, 110 + i * 50);
            });
        }
        function closeSidebar() {
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
            hamburger.classList.remove('active');
            hamburger.setAttribute('aria-expanded', 'false');
            document.body.classList.remove('sidebar-open');
        }

        hamburger.addEventListener('click', () => sidebar.classList.contains('active') ? closeSidebar() : openSidebar());
        closeBtn.addEventListener('click', closeSidebar);
        overlay.addEventListener('click', closeSidebar);
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeSidebar(); });

        /* ─── SCROLL REVEAL ─────────────────────────────────── */
        const revealObs = new IntersectionObserver(entries => {
            entries.forEach((e, i) => {
                if (e.isIntersecting) {
                    setTimeout(() => e.target.classList.add('visible'), i * 80);
                    revealObs.unobserve(e.target);
                }
            });
        }, { threshold: .12 });
        document.querySelectorAll('.reveal').forEach(el => revealObs.observe(el));

        /* ─── AUTO DISMISS FLASH ────────────────────────────── */
        setTimeout(() => {
            document.querySelectorAll('.flash').forEach(f => {
                f.style.transition = 'opacity .4s ease, transform .4s ease';
                f.style.opacity    = '0';
                f.style.transform  = 'translateX(12px)';
                setTimeout(() => f.remove(), 400);
            });
        }, 5000);
    </script>

    {% block extra_js %}<script src="https://unpkg.com/html5-qrcode"></script>{% endblock %}
</body>
</html>


